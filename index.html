<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>INOVA Measurement v1.0.0</title>
  <link rel="manifest" href="manifest.webmanifest">
  <meta name="theme-color" content="#0B6DB7">
  <style>
    body { font-family: Arial, sans-serif; margin:0; background:#f5f7fa; }
    .screen { display:none; padding:20px; }
    .screen.active { display:block; }
    .panel { background:#fff; border-radius:10px; padding:20px; margin-bottom:20px; box-shadow:0 2px 6px rgba(0,0,0,0.1); }
    h2 { margin-top:0; }
    .btn { padding:10px 18px; border:none; border-radius:6px; margin:4px; cursor:pointer; font-size:15px; }
    .btn-primary { background:#0B6DB7; color:#fff; }
    .btn-danger { background:#e74c3c; color:#fff; }
    .btn-secondary { background:#95a5a6; color:#fff; }
    .btn-warning { background:#f39c12; color:#fff; }
    footer { text-align:center; padding:15px; font-size:13px; color:#666; }
    canvas { width:100%; height:200px; }
    .version-tag { float:right; font-size:12px; color:#999; }
  </style>
</head>
<body>

<main>
  <!-- Tela 1 -->
  <section id="screen-home" class="screen active">
    <div class="panel" style="text-align:center;">
      <img src="icons/icon-192.png" alt="logo" width="80"/><br/>
      <h1>INOVA- Measurement</h1>
      <p>Web</p>
      <button id="go-measure" class="btn btn-primary">Medi√ß√£o</button>
      <p style="margin-top:20px; font-size:13px;">Desenvolvido por INOVA Controle¬Æ 
        <span class="version-tag">v1.0.0</span>
      </p>
    </div>
  </section>

  <!-- Tela 2 -->
  <section id="screen-measure" class="screen">
    <div class="panel">
      <h2>Medi√ß√£o (Sess√£o atual)</h2>

      <div class="panel">
        <h3>Medi√ß√£o realizada</h3>
        <input type="text" id="value-input" placeholder="Digite o valor e pressione Enter"/>
        <div style="display:flex; gap:10px; margin-top:10px;">
          <button id="save-btn" class="btn btn-primary">Salvar</button>
          <button id="cancel-btn" class="btn btn-danger">Anular</button>
        </div>
        <p id="last-value" style="font-size:28px; font-weight:bold; margin:10px 0;">‚Äî</p>
        <p id="status-label" style="font-weight:bold; color:#888;">‚è≥ Aguardando in√≠cio da medi√ß√£o</p>
      </div>

      <div class="panel">
        <h3>Gr√°fico de medi√ß√µes</h3>
        <canvas id="chart"></canvas>
      </div>

      <div class="panel">
        <h3>Configura√ß√£o</h3>
        <label>Dimens√£o nominal *</label>
        <input type="number" id="dim-nom" step="0.0001" required><br/>
        <label>Toler√¢ncia superior *</label>
        <input type="number" id="tol-plus" step="0.0001" required><br/>
        <label>Toler√¢ncia inferior *</label>
        <input type="number" id="tol-minus" step="0.0001" required><br/>
        <label>Nome da pe√ßa *</label>
        <input type="text" id="peca" required><br/>
        <label>C√≥digo *</label>
        <input type="text" id="codigo" required><br/>
        <label>Operador (opcional)</label>
        <input type="text" id="operador"><br/>
        <label>Turno (opcional)</label>
        <input type="text" id="turno"><br/>
        <div style="display:flex; gap:10px; flex-wrap:wrap; margin-top:10px;">
          <button id="start-btn" class="btn btn-primary">Iniciar</button>
          <button id="clear-btn" class="btn btn-secondary">Limpar</button>
          <button id="btn-history" class="btn btn-secondary">Ver valores</button>
        </div>
        <textarea id="obs" placeholder="Observa√ß√µes (opcional)" style="width:100%; margin-top:10px;"></textarea>
      </div>

      <button id="back-home" class="btn btn-secondary">üè† Voltar ao In√≠cio</button>
    </div>
  </section>

  <!-- Tela 3 -->
  <section id="screen-history" class="screen">
    <div class="panel">
      <h2>Hist√≥rico Global & Exporta√ß√£o</h2>
      <div style="margin-bottom:10px;">
        <button id="pin-btn" class="btn btn-warning">Definir/Alterar PIN</button>
        <button id="export-btn" class="btn btn-primary">Exportar CSV</button>
        <button id="clear-hist" class="btn btn-danger">Limpar hist√≥rico local</button>
      </div>
      <table border="1" width="100%" style="font-size:13px;">
        <thead><tr>
          <th>N¬∫ Global</th><th>Data</th><th>Sess√£o_ID</th><th>Pe√ßa</th><th>C√≥digo</th><th>Resultado</th>
        </tr></thead>
        <tbody id="hist-body"></tbody>
      </table>
      <button id="back-to-measure" class="btn btn-secondary" style="margin-top:15px;">Voltar √† Medi√ß√£o</button>
    </div>
  </section>
</main>

<footer>
  Desenvolvido por INOVA Controle¬Æ <span class="version-tag">v1.0.0</span>
</footer>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
window.addEventListener('DOMContentLoaded', () => {
  const screens = {
    home: document.getElementById('screen-home'),
    measure: document.getElementById('screen-measure'),
    history: document.getElementById('screen-history')
  };
  const show = (el) => { Object.values(screens).forEach(s => s.classList.remove('active')); el.classList.add('active'); };

  // Navega√ß√£o
  document.getElementById('go-measure').onclick = () => show(screens.measure);
  document.getElementById('back-home').onclick = () => show(screens.home);
  document.getElementById('btn-history').onclick = () => show(screens.history);
  document.getElementById('back-to-measure').onclick = () => show(screens.measure);

  // Chart
  const ctx = document.getElementById('chart').getContext('2d');
  let chart = new Chart(ctx, {
    type:'line',
    data:{ labels:[], datasets:[{label:'Medi√ß√µes',data:[], borderColor:'#0B6DB7',pointRadius:5}] },
    options:{ responsive:true, plugins:{legend:{display:false}} }
  });

  let values = [];

  // Bot√£o salvar
  document.getElementById('save-btn').onclick = () => {
    const val = parseFloat(document.getElementById('value-input').value);
    if(isNaN(val)) return;
    values.push(val);
    chart.data.labels.push(values.length);
    chart.data.datasets[0].data.push(val);
    chart.update();
    document.getElementById('last-value').textContent = val.toFixed(4);
    document.getElementById('status-label').textContent = val >= 0 ? '‚úÖ Registrado' : '‚ùå Inv√°lido';
    document.getElementById('value-input').value='';
  };

  // Bot√£o anular (marca √∫ltimo como ANULADO no hist√≥rico)
  document.getElementById('cancel-btn').onclick = () => {
    if(values.length > 0) {
      const last = values.pop();
      chart.data.labels.pop();
      chart.data.datasets[0].data.pop();
      chart.update();
      document.getElementById('status-label').textContent = '‚ö†Ô∏è √öltima medi√ß√£o anulada';
    }
  };

  // Bot√£o limpar
  document.getElementById('clear-btn').onclick = () => {
    document.querySelectorAll('#dim-nom,#tol-plus,#tol-minus,#peca,#codigo,#operador,#turno,#obs,#value-input').forEach(i => i.value='');
    values=[]; chart.data.labels=[]; chart.data.datasets[0].data=[]; chart.update();
    document.getElementById('last-value').textContent='‚Äî';
    document.getElementById('status-label').textContent='‚è≥ Aguardando in√≠cio da medi√ß√£o';
  };
});
</script>
  <script>
window.addEventListener('DOMContentLoaded', () => {
  const screens = {
    home:    document.getElementById('screen-home'),
    measure: document.getElementById('screen-measure'),
    history: document.getElementById('screen-history'),
  };
  const show = (el) => {
    Object.values(screens).forEach(s => s.classList.remove('active'));
    el.classList.add('active');
  };

  document.getElementById('go-measure')?.addEventListener('click', () => show(screens.measure));
  document.getElementById('back-to-measure')?.addEventListener('click', () => show(screens.measure));
  document.getElementById('btn-history')?.addEventListener('click', () => show(screens.history));
});
</script>

</body>
</html>

